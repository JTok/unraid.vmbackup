Menu="Vmbackup:6"
Title="Restore"
Icon="clone"
---

<?php

  /* vmbackup plugin
    copyright JTok */

?>

<div id="restore_div" class="wrapper_div">

  <!-- current config -->
  <div class="wrapper_div">
    <div id="current_config_restore_div" class="grid_container_left pad_config_top">
      <label name="current_config_restore_label" class="config_label config_text">Currently editing config:</label>
      <div class="user_input_div"><select id="current_config_restore" name="current_config_restore" size="1">
        <option value="default">default</option>
        <?php
          $configs = glob("/boot/config/plugins/vmbackup/configs/*", GLOB_ONLYDIR);
          foreach ($configs as $config_path) {
            $config = basename($config_path)?>
            <option value="<?= $config ?>"><?= $config ?></option>
        <?php
          } ?>
      </select></div>

      <span name="current_config_restore_help" class="custom_inline_help">
        <p>Select a config to edit.</p>
        <ul>
          <li>To add a config, go to the Manage Configs tab.</li>
          <li>Default is 'default'.</li>
        </ul>
      </span>
    </div>
  </div>

  <!-- instructions -->
  <div class="wrapper_div">
    <span class="important_info"><p>Instructions</p></span>
    <p>From here you can restore your backups. It searches the backup directory of the currently selected config.
    <br>This may include backups from other configs if you back them up to the same root directory.
    <br>
    <ul>
      <li>Choose a backup folder.</li>
      <li>Select the files to restore.</li>
      <li>Confirm restore.</li>
    </ul>
    </p>
  </div>

  <form id="restore_form" name="restore_form" autocomplete="off" method="POST" action="/plugins/vmbackup/include/restore.php" target="progressFrame">

    <div class="container_full">
      <!-- select files -->
      <!-- <div id="title" class="nocontrol full_width_title">Files to Restore</div>

      <div id="choose_files_div" name="choose_files_div" class="clear_both">
        <label>Choose the file types:</label>
        <div class="clear_both"><input type="checkbox" name="vdisk" value="vdisk" checked>vdisk<input type="checkbox" name="config" value="config" checked>config<input type="checkbox" name="nvram" value="nvram" checked>nvram</div>
      </div> -->

      <!-- choose backup -->
      <div id="title" class="nocontrol full_width_title">Restore Backup</div>
      <div id="select_folder_div" name="select_folder_div" class="clear_both">
        <label>Select backup folder:</label>
        <div class="user_input_div"><input type="text" id="select_folder" name="select_folder" class="setting" value="" readonly placeholder="Select a backup" data-pickroot="<?=(!empty($conf_array['backup_location'])) ? $conf_array['backup_location'] : '/mnt/user/';?>" data-pickfilter="NO_FILES_FILTER" data-pickfolders="true" required></div>
      </div>
      <div id="select_files_div" name="select_files_div">
        <label>Select files to restore:</label>
        <div class="user_input_div"><select id="select_files" name="select_files" size="1" multiple="multiple" style="display:none">
          <?$files = file('/tmp/vmbackup/files/restore_files.txt', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
          foreach ($files as $file):?>
            <?=mk_option_check("", $file, $file)?>
          <?endforeach;?>
        </select></div>
      </div>
      <div id="restore_button_div" name="restore_button_div" class="clear_both">
        <input type="button" id="restore_button" name="#restore_button" value="Restore">
      </div>
    </div>
  </form>
</div>
